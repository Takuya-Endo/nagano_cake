<h1>注文履歴詳細</h1>

<h2>注文情報</h2>
<table>
  <tr> <td>注文日</td> <td><%= @order.updated_at.strftime("%Y/%m/%d") %></td> </tr>
  <tr>
    <td>配送先</td>
    <td>
      <p><%= @order.shipping_postal_code %></p>
      <p><%= @order.shipping_address %></p>
      <p><%= @order.shipping_name %></p>
    </td>
  </tr>
  <tr> <td>支払方法</td> <td><%= @order.payment %></td> </tr>
  <tr> <td>ステータス</td> <td></td> </tr>
</table>

<h2>注文内容</h2>
<table>
  <tr> <th>商品</th> <th>単価(税込)</th> <th>個数</th> <th>小計</th> </tr>
    <% total_price = 0 %>
    <% @order_details = OrderDetail.where(order_id: @order.id) %>
    <% @order_details.each do |order_detail| %>
      <% item = @items.find(order_detail.item_id) %>
      <tr>
        <td><%= item.name %></td>
        <td><%= order_detail.tax_included_price %></td>
        <td><%= order_detail.amount %></td>
        <td><%= order_detail.tax_included_price * order_detail.amount %></td>
      </tr>
      <% total_price += (order_detail.tax_included_price * order_detail.amount) %>
    <% end %>
</table>

<h2>請求情報</h2>
<table>
  <tr> <td>商品合計</td> <td><%= total_price %></td> </tr>
  <tr> <td>配送料</td> <td><%= 800 %></td> </tr>
  <tr> <td>ご請求額</td> <td><%= @order.total_payment %></td> </tr>
</table>